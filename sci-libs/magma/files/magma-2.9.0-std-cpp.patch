From d435bd01735d7a99bc77d307a4be7ce43f483843 Mon Sep 17 00:00:00 2001
From: cyy <cyyever@outlook.com>
Date: Sat, 17 May 2025 07:51:45 +0800
Subject: [PATCH 1/3] Improve C/C++ standard setting in CMake

---
 CMakeLists.txt | 28 ++++++----------------------
 1 file changed, 6 insertions(+), 22 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 07987e045..902d9f62c 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -6,9 +6,9 @@ cmake_minimum_required( VERSION 3.18 )
 option( USE_FORTRAN "Fortran is required for some tester checks, but can be disabled with reduced functionality" ON )
 
 if (USE_FORTRAN)
-    project( MAGMA C CXX Fortran )
+    project( MAGMA LANGUAGES C CXX Fortran )
 else()
-    project( MAGMA C CXX )
+    project( MAGMA LANGUAGES C CXX )
 endif()
 
 
@@ -63,26 +63,10 @@ endif()
 # ----------------------------------------
 # use C++14 and C99
 # see http://stackoverflow.com/questions/10851247/how-to-activate-c-11-in-cmake
-include(CheckCXXCompilerFlag)
-include(CheckCCompilerFlag)
-CHECK_CXX_COMPILER_FLAG("-std=c++14" COMPILER_SUPPORTS_CXX14)
-CHECK_CXX_COMPILER_FLAG("-std=c++0x" COMPILER_SUPPORTS_CXX0X)
-CHECK_CXX_COMPILER_FLAG("-fPIC" COMPILER_SUPPORTS_FPIC)
-if (COMPILER_SUPPORTS_CXX14)
-    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++14")
-elseif(COMPILER_SUPPORTS_CXX0X)
-    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++0x")
-else()
-    message( WARNING "The compiler ${CMAKE_CXX_COMPILER} doesn't support the -std=c++14 flag. Some code may not compile.")
-endif()
-
-CHECK_C_COMPILER_FLAG("-std=c99" COMPILER_SUPPORTS_C99)
-if (COMPILER_SUPPORTS_C99)
-    set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -std=c99")
-else()
-    message( WARNING "The compiler ${CMAKE_C_COMPILER} doesn't support the -std=c99 flag. Some code may not compile.")
-endif()
-
+set( CMAKE_C_STANDARD 99 )
+set( CMAKE_C_STANDARD_REQUIRED OFF )
+set( CMAKE_CXX_STANDARD 14 )
+set( CMAKE_CXX_STANDARD_REQUIRED OFF )
 
 # ----------------------------------------
 # check Fortran name mangling

From eeb5de8cd143bc200dbe4c1cd7a37485d2f14193 Mon Sep 17 00:00:00 2001
From: cyy <cyyever@outlook.com>
Date: Thu, 29 May 2025 17:18:56 +0800
Subject: [PATCH 2/3] Fix fpic

Signed-off-by: cyy <cyyever@outlook.com>
---
 CMakeLists.txt | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 902d9f62c..7045ef3f6 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -62,11 +62,12 @@ endif()
 
 # ----------------------------------------
 # use C++14 and C99
-# see http://stackoverflow.com/questions/10851247/how-to-activate-c-11-in-cmake
 set( CMAKE_C_STANDARD 99 )
 set( CMAKE_C_STANDARD_REQUIRED OFF )
 set( CMAKE_CXX_STANDARD 14 )
 set( CMAKE_CXX_STANDARD_REQUIRED OFF )
+include(CheckCXXCompilerFlag)
+CHECK_CXX_COMPILER_FLAG("-fPIC" COMPILER_SUPPORTS_FPIC)
 
 # ----------------------------------------
 # check Fortran name mangling

From b657f0a81681689cdded11f41d59103e4169abb4 Mon Sep 17 00:00:00 2001
From: Mark Gates <mgates3@utk.edu>
Date: Thu, 17 Jul 2025 15:04:01 +0000
Subject: [PATCH 3/3] cmake: require c99 and c++14; prohibit decay to older
 standards and compiler extensions (gnu, etc.)

---
 CMakeLists.txt | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 7045ef3f6..76c91c99e 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -63,9 +63,11 @@ endif()
 # ----------------------------------------
 # use C++14 and C99
 set( CMAKE_C_STANDARD 99 )
-set( CMAKE_C_STANDARD_REQUIRED OFF )
+set( CMAKE_C_STANDARD_REQUIRED on )
+set( CMAKE_C_EXTENSIONS off )
 set( CMAKE_CXX_STANDARD 14 )
-set( CMAKE_CXX_STANDARD_REQUIRED OFF )
+set( CMAKE_CXX_STANDARD_REQUIRED on )  # prohibit "decay" to older standards (std=c++11, etc.)
+set( CMAKE_CXX_EXTENSIONS off )        # prohibit std=gnu++17, etc.
 include(CheckCXXCompilerFlag)
 CHECK_CXX_COMPILER_FLAG("-fPIC" COMPILER_SUPPORTS_FPIC)
 
